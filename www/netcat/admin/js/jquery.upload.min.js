(function(e){function r(a,b){if(b.value){var c=h?b.files[0].type:"",d=h?b.files[0].name:b.value.substr(b.value.lastIndexOf("\\")+1),f=h?b.files[0].size:0,g=j(a),i=e(b).hide(),l=s(a,d);k(g)&&(i.prop("class","nc-upload-file-input").appendTo(l),i=e('<input class="nc-upload-input" type="file" name="'+b.name+'" multiple />').appendTo(g),t(i),m(g));l.hide().appendTo(a).slideDown(100).find(".nc-upload-file-custom-name input:text").focus();f<u&&p(c)?(f=new FileReader,f.onload=function(a){n(l,c,d,a.target.result,
!0)},f.readAsDataURL(b.files[0])):n(l,c,d,null,!0)}}function w(a,b){var c=j(a),d="f_"+c.data("fieldName")+"_content"+(k(c)?"[]":""),f=c.data("maxFiles");e.each(b,function(b,i){if(f&&"0"!=f&&q(c)>=f)return!1;var e=s(a,i.name,"i"),h=new FileReader;h.onload=function(a){o(d,i.name+"/"+a.target.result,"nc-upload-file-content").appendTo(e);a=i.size<u&&p(i.type)?a.target.result:null;n(e,i.type,i.name,a,!0)};h.readAsDataURL(i);e.hide().appendTo(a).slideDown(100)});m(c)}function s(a,b,c){var d=j(a),b=e('<div class="nc-upload-file"><div class="nc-upload-file-info"><span class="nc-upload-file-name">'+
b+'</span> <a href="#" class="nc-upload-file-remove" tabindex="-1">\u00d7</a></div></div>');if(k(d)){var f=d.data("fieldId"),g=q(a);d.data("customName")&&(d=e("<input />",{type:"text",name:"f_"+d.data("fieldName")+"_name[]",placeholder:d.data("customNameCaption"),value:""}),e('<div class="nc-upload-file-custom-name" />').append(d).appendTo(b));b.append(o("priority_multifile["+f+"][]",-1,"nc-upload-file-priority"),o("multifile_new_priority["+f+"][]",g,"nc-upload-file-priority"),o("multifile_upload_type["+
f+"][]",c||"f","nc-upload-file-upload-type"))}b.appendTo(a);v(b);return b}function n(a,b,c,d,f){var g=e("<div />").addClass("nc-upload-file-preview nc-upload-file-drag-handle");(b=d&&p(b))&&h?(g.addClass("nc-upload-file-preview-image").append('<img src="'+d+'" />'),j(a).addClass("nc-upload-with-preview")):(d=c.lastIndexOf("."),g.addClass("nc-upload-file-preview-other"),0<d&&g.append('<span class="nc-upload-file-extension">'+c.substr(d+1)+"</span>"));a.prepend('<div class="nc-upload-file-drag-icon nc-upload-file-drag-handle"><i class="nc-icon nc--file-text"></i></div>',
g);if((b||a.closest(".nc-upload-with-preview").length)&&h)f?g.slideDown(100):g.show();return g}function p(a){return a?a.match(/^image\/(jpe?g|png|gif|bmp|svg([+-]xml)?)$/i):!1}function k(a){return a.hasClass("nc-upload-multifile")}function j(a){return a.closest(".nc-upload")}function q(a){return a.find(".nc-upload-file:visible").length}function m(a){var b=a.data("maxFiles");if(b&&k(a)){var c=a.find(".nc-upload-input");q(a)>=b?c.hide():c.show()}}function t(a){h||a[0].attachEvent("onpropertychange",
function(){var a=window.event.srcElement;if("value"==window.event.propertyName&&a.value.length){var c=e(a);c.is(":visible")&&r(j(c).find(".nc-upload-files"),a)}})}function o(a,b,c){return e("<input />",{type:"hidden",name:a,value:b,"class":c})}function x(a){a.preventDefault();a.stopPropagation();var b=e(a.target).closest(".nc-upload-file");b.find(".nc-upload-file-remove-hidden").val("1");b.find(".nc-upload-file-remove-checkbox").prop("checked","checked");b.slideUp(100,function(){b.find(".nc-upload-file-input, .nc-upload-file-content, .nc-upload-file-upload-type, .nc-upload-file-priority, .nc-upload-file-custom-name").remove();
var a=j(b);a.hasClass("nc-upload-with-preview")&&0==a.find(".nc-upload-file:visible .nc-upload-file-preview-image").length&&a.removeClass("nc-upload-with-preview");var d=a.find(".nc-upload-input"),f=d.clone().val("").show();d.replaceWith(f);d=e.Event("change");d.target=f[0];e(document).trigger(d);m(a)});return!1}function v(a){a.find(".nc-upload-file-remove").off("click.nc-upload").on("click.nc-upload",x)}if(e){var u=5242880,h="FileReader"in window;e.fn.upload=function(){return this.each(function(){var a=
e(this);if(!a.hasClass("nc-upload-applied")){a.addClass("nc-upload-applied");var b=k(a),c=a.find(".nc-upload-files"),d=c.find(".nc-upload-file");0<d.length&&!b&&a.find(".nc-upload-input").hide();d.each(function(){var a=e(this),b=a.data("type"),c=a.find(".nc-upload-file-name"),d=c.html(),c=c.prop("href");n(a,b,d,c,!1)});setTimeout(function(){m(a)},10);a.on("change",".nc-upload-input",function(){if(this.files&&this.files.length)1<this.files.length&&h?(w(c,this.files),this.value=null):r(c,this)});h||
t(a.find(".nc-upload-input"));v(c);if(b){var f;c.on("mousedown",".nc-upload-file-drag-handle",function(a){a.preventDefault();c.addClass("nc--dragging");f=e(this).closest(".nc-upload-file").addClass("nc--dragged");e(window).on("mouseup.nc-upload",function(){c.removeClass("nc--dragging");f.removeClass("nc--dragged");c.find(".nc-upload-file").each(function(a){e(this).find(".nc-upload-file-priority[name^=multifile_new_priority]").val(a)});e(window).off("mouseup.nc-upload");f=null})});c.on("mousemove",
".nc-upload-file",function(a){var b=e(this);if(f&&!b.hasClass("nc--dragged")){if("none"==b.css("float"))var a=a.pageY-b.offset().top,c=b.height();else a=a.pageX-b.offset().left,c=b.width();(a=a<c/2)?f.insertBefore(b):f.insertAfter(b)}})}}})};e(document).on("apply-upload",function(){e(".nc-upload").upload()})}})(window.$nc||window.jQuery);
